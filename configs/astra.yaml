log:
  output: stdout
  format: json

acme:
  email: you@example.com
  ca: ""
  staging: false
  key_type: ""
  renew_window: ""
  storage_path: /data/acme

limits:
  rps: 20
  burst: 40
  conn_limit: 100
  ws_conn_limit: 20
  whitelist_ips: []
  max_body_bytes: 10485760
  max_uri_bytes: 8192
  max_query_bytes: 8192
  max_params: 100
  max_header_bytes: 1048576
  max_url_length: 2048
  risk_threshold: 5
  risk_ttl_seconds: 600
  risk_status_window: 60
  ban_after: 3
  ban_seconds: 3600
  rate_429_ban_after: 20
  rate_429_window_seconds: 60
  rate_429_ban_seconds: 600
  waf_ban_seconds: 90
  rate_policies:
    - name: api
      path_globs: [/api/*]
      rps: 5
      burst: 20
      key: ip_route
      ban_after_429: 20
      ban_window_seconds: 60
      ban_seconds: 600
    - name: login
      path_globs: [/api/auth/login, /auth/login]
      rps: 0.2
      burst: 3
      key: ip
      ban_after_429: 10
      ban_window_seconds: 60
      ban_seconds: 1800

challenge:
  enabled: true
  cookie_ttl_seconds: 1800
  bind_ip: true
  bind_ua: false
  exempt_globs:
    - /api/*
    - /cabinet/ws*
    - /.well-known/acme-challenge/*
    - /healthz
    - /metrics
    - '*.css'
    - '*.js'
    - '*.png'
    - '*.woff2'

waf:
  enabled: true
  mode: block
  score_threshold: 7 # legacy alias
  inbound_threshold: 7
  paranoia_level: 2
  max_inspect_bytes: 65536
  max_values_per_collection: 200
  max_total_values: 500
  max_json_values: 300
  max_body_values: 300
  allowed_methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS, HEAD]
  blocked_content_types:
    - application/x-java-serialized-object
  exempt_globs:
    - /.well-known/acme-challenge/*
    - /healthz
    - /metrics
  exempt_hosts: []
  exempt_rule_ids: []
  exempt_rule_ids_by_glob:
    /cabinet/ws*:
      - waf-pl2-xss-basic
      - waf-pl3-obfuscated-js
  # rules: [] # optional custom rules (id, pattern, targets, score, phase, action, paranoia, transforms)

servers:
  - hostname: panel.astracat.ru
    handles:
      - upstream: 172.18.0.4:3000

  - hostname: cabinet.astracat.ru
    handles:
      - matcher_name: api
        matcher:
          path_glob: /api/*
        strip_prefix: /api
        upstream: remnawave_bot:8080

      - matcher_name: ws
        matcher:
          path_glob: /cabinet/ws*
        upstream: remnawave_bot:8080

      - upstream: cabinet_frontend:80
